"""
TESTING AND VERIFICATION INSTRUCTIONS
Інструкції для перевірки роботи сервісу
"""

# ============================================================================

# QUICK VERIFICATION COMMANDS

# ============================================================================

VERIFICATION_STEPS = """

╔═══════════════════════════════════════════════════════════════════════════╗
║ RECOMMENDATION SERVICE - VERIFICATION GUIDE ║
║ Посібник з перевірки роботи сервісу ║
╚═══════════════════════════════════════════════════════════════════════════╝

## КРОК 1: Запустити Docker Compose

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd RecService
docker-compose up -d

Дочекайтеся 30-60 секунд, поки контейнери ініціалізуються.

Перевірка:
docker ps | grep rec\_

Повинні бути контейнери:
✓ rec_api
✓ rec_consumer
✓ rec_postgres
✓ rec_rabbitmq

## КРОК 2: Перевірити Health Check

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

curl http://localhost:8001/health

Очікуємо відповідь:
{
"status": "healthy",
"database": "connected",
"message": "Recommendation Service is running"
}

## КРОК 3: Відправити Тестовий Event

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd RecService
python src/tests/producer.py single 1 10

Результат:
✅ Event sent: {"event": "news_viewed", "user_id": 1, "news_id": 10, ...}

## КРОК 4: Отримати Рекомендації

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

curl "http://localhost:8001/api/v1/recommendations/1?count=5"

Очікуємо JSON з рекомендаціями:
{
"user_id": 1,
"recommendations": [
{
"news_id": 5,
"title": "...",
"category": "...",
"similarity_score": 0.85,
...
}
],
"total_count": 5
}

## КРОК 5: Отримати Інтереси Користувача

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

curl "http://localhost:8001/api/v1/recommendations/1/interests"

Очікуємо:
{
"user_id": 1,
"interests": {
"Technology": 0.6,
"Sports": 0.4
},
"total_activities": 3
}

## КРОК 6: Отримати Популярні Новини

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

curl "http://localhost:8001/api/v1/recommendations/popular/news?count=5"

Очікуємо популярні новини за кількістю переглядів.

## КРОК 7: Перевірити RabbitMQ

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Відкрийте: http://localhost:15672

Логін: guest
Пароль: guest

Перевірити:

- Queue 'news_events' існує
- В ньому повинна бути кількість повідомлень

## КРОК 8: Перевірити Логи

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

API логи:
docker logs rec_api -f

Consumer логи:
docker logs rec_consumer -f

Локальні логи:
tail -f logs/app.log
tail -f logs/error.log

## КРОК 9: Запустити Unit Тесты

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

cd RecService
pip install pytest pytest-asyncio
pytest src/tests/ -v

Очікуємо:
passed = 15+ tests

## КРОК 10: Отримати Документацію API

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Swagger UI:
http://localhost:8001/api/v1/docs

ReDoc:
http://localhost:8001/api/v1/redoc

╔═══════════════════════════════════════════════════════════════════════════╗
║ ADVANCED TESTING ║
╚═══════════════════════════════════════════════════════════════════════════╝

## Симулювання поведінки користувачів

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Створити 20 подій від користувача 2

python src/tests/producer.py simulate 2 20

# Потім отримати рекомендації

curl "http://localhost:8001/api/v1/recommendations/2?count=10"

## Batch обробка

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Отправити пакет подій для однієї новини

python src/tests/producer.py batch 3 10 11 12 13 14

## Тестування різних користувачів

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

for user in 1 2 3 4 5; do
echo "User $user recommendations:"
  curl -s "http://localhost:8001/api/v1/recommendations/$user?count=3" | jq .
done

## Перевірка затримок

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

# Виміряти час обробки рекомендацій

time curl "http://localhost:8001/api/v1/recommendations/1"

Очікуємо: < 500ms

╔═══════════════════════════════════════════════════════════════════════════╗
║ TROUBLESHOOTING ║
╚═══════════════════════════════════════════════════════════════════════════╝

## Проблема: "Connection refused" на port 8001

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Рішення:

1. Перевірте, запущений ли контейнер:
   docker ps | grep rec_api

2. Перевірте логи:
   docker logs rec_api

3. Дочекайтесь 30-60 сек ініціалізації

## Проблема: "Database connection error"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Рішення:

1. Перезапустіть PostgreSQL:
   docker-compose restart postgres

2. Перезапустіть API:
   docker-compose restart recommendation-api

3. Перевірте логи БД:
   docker logs rec_postgres

## Проблема: "No embeddings found"

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Рішення:

# Запустіть генерацію embeddings вручну

docker exec rec_api python -m src.scripts.generate_embeddings

## Проблема: Consumer не обробляє события

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Рішення:

1. Перевірте логи consumer:
   docker logs rec_consumer -f

2. Перезапустіть consumer:
   docker-compose restart recommendation-consumer

## Проблема: Повільні рекомендації

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Рішення:

1. Перевірте, чи згенеровані embeddings:
   curl "http://localhost:8001/api/v1/recommendations/popular/news"

2. Чекайте першого запуску при завантаженні embedding моделі

3. Чекайте першого запуску в consumer для обробки подій

╔═══════════════════════════════════════════════════════════════════════════╗
║ EXPECTED RESULTS SUMMARY ║
║ Очікувані результати ║
╚═══════════════════════════════════════════════════════════════════════════╝

✅ Docker контейнери запущені і здорові
✅ API відповідає на /health з статусом "healthy"
✅ Events успішно обробляються consumer'ом
✅ Рекомендації генеруються персоналізовані
✅ API документація доступна на /api/v1/docs
✅ Логи пишуться в logs/app.log
✅ RabbitMQ queue обробляє события
✅ Unit тесты проходять успішно
✅ Затримка відповіді < 500ms
✅ База даних містить новини з embeddings

╔═══════════════════════════════════════════════════════════════════════════╗
║ NEXT STEPS ║
║ Наступні кроки ║
╚═══════════════════════════════════════════════════════════════════════════╝

1. Інтегрувати з UserService для отримання подій
2. Інтегрувати з SearchService для використання рекомендацій
3. Налаштувати load testing для перевірки масштабованості
4. Розгорнути в production (Docker Swarm / Kubernetes)
5. Налаштувати моніторинг і alarms

╔═══════════════════════════════════════════════════════════════════════════╗
║ SUPPORT ║
║ Допомога ║
╚═══════════════════════════════════════════════════════════════════════════╝

📚 Документація:

- README.md - Повна документація
- QUICK_START.md - Швидкий старт
- DEVELOPMENT.md - Локальна розробка
- examples.py - Приклади коду

🔍 Перевірка установки:
python verify_setup.py

💬 API документація:
http://localhost:8001/api/v1/docs

📊 RabbitMQ консоль:
http://localhost:15672 (guest:guest)

🐛 Перевірка логів:
docker logs rec_api -f
docker logs rec_consumer -f

═══════════════════════════════════════════════════════════════════════════════

УСПІХІВ У ТЕСТУВАННІ! 🚀

═══════════════════════════════════════════════════════════════════════════════
"""

if **name** == "**main**":
print(VERIFICATION_STEPS)
